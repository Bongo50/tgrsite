{% extends "tgrsite/main.html" %}
{% load markdown_tags %}

{% block title %}Minutes{% endblock %}
{% block pagetitle %}{{ object.title }}{% endblock %}

{% block breadcrumbs_parents %}
    <li class="breadcrumb-item"><a href="{% url "minutes:index" %}">Minutes</a></li>
{% endblock %}
{% block breadcrumbs_child %}{{ object.title }}{% endblock %}

{% block body %}

    <div class="card mb-3">
        <a data-toggle="collapse" href="#past_meetings" class="card-header">
            Past Meetings
        </a>
        <div class="collapse" id="past_meetings">
            <div class="card-body">
                {% for root in object.folder.roots %}
                    {% include "minutes/widgets/foldertree.html" with folder=root child=object mb=forloop.last %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% if perms.minutes.add_meeting or perms.minutes.change_meeting %}
        <p class="btn-group-vertical btn-block">
            {% if perms.minutes.add_meeting %}
                <a class="btn btn-outline-success" href="{% url "minutes:new_meeting" %}">New</a>
            {% endif %}
            {% if perms.minutes.change_meeting %}
                <a class="btn btn-outline-primary" href="{% url "minutes:change_meeting" object.id %}">Edit</a>
            {% endif %}
        </p>
    {% endif %}
    <div class="card">
        <div class="card-header d-flex flex-column flex-sm-row align-items-sm-center justify-content-between">
            <h3 class="card-text mb-0">{{ object.date|date }}</h3>
            <span class="card-text text-muted">Posted by {% include "parts/render_member.html" with member=object.author %}</span>
        </div>
        <div class="card-body">
            <p class="card-text">{{ object.body|parse_md }}</p>
        </div>
        {% if next or prev %}
            <div class="card-footer">
                <div class="btn-group btn-block">
                    {% if prev %}
                        <a class="btn btn-outline-primary" href="{{ prev.get_absolute_url }}"><i
                                class="fas fa-angle-left"></i><span class="sr-only">Previous</span></a>
                    {% endif %}

                    {% if next %}
                        <a class="btn btn-outline-primary" href="{{ next.get_absolute_url }}"><i
                                class="fas fa-angle-right"></i><span class="sr-only">Next</span></a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

{% endblock %}

{% block leftcontents %}
    {{ block.super }}
    {% if perms.timetable.change_timetable %}
        <a class="btn btn-block btn-outline-dark" href="{% url "admin:minutes_meeting_changelist" %}">Edit</a>
    {% endif %}
{% endblock %}