function csrfSafeMethod(b){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(b)}$.ajaxSetup({beforeSend:function(b,f){csrfSafeMethod(f.type)||this.crossDomain||(f=getCookie("csrftoken"),b.setRequestHeader("X-CSRFToken",f))}});function toLines(b,f){b=b.split("\n");let l=0,q=null,g=null;for(var k=0;k<length(b);k++){null===q&&l+length(b[k])>=f.start&&(q={line:k,pos:f.start-l});if(l+length(b[k])>=f.end){g={line:k,pos:f.end-l};break}l=l+length(b[k])+1}return{lines:b,selection:{start:q,end:g}}}
function length(b){return b.length}
(function(b,f,l,q){b.fn.MarkdownEditor=function(g){var k=function(a,h){let m=a.value;a=h;-1<m.indexOf("\r\n")&&(h=m.replace(/\r\n/g,"\n").slice(0,h).match(/\n/g),a+=h?h.length:0);return a},n={bold:{start:"**",end:"**",placeholder:"Your bold text",line:!1,block:!1},strike:{start:"~~",end:"~~",placeholder:"Your struckthrough text",line:!1,block:!1},italic:{start:"*",end:"*",placeholder:"Your emphasized text",line:!1,block:!1},h1:{start:"#",end:"",placeholder:" Your header",line:!0,block:!1},h2news:{start:"## ",
end:" {.news-bg}",placeholder:"Your header",line:!0,block:!1},h3news:{start:"### ",end:" {.news-bg}",placeholder:"Your header",line:!0,block:!1},quote:{start:"> ",end:"",placeholder:"Your quote",line:!0,block:!1},link:{start:"[",end:"](https://example.org/)",placeholder:"Add your link text",line:!1,block:!1},image:{start:"![",end:"](https://example.org/)",placeholder:"Add image description",line:!1,block:!1},imageleft:{start:"![",end:"](https://example.org/){.news-image-left}",placeholder:"Add image description",
line:!1,block:!1},imageright:{start:"![",end:"](https://example.org/){.news-image-right}",placeholder:"Add image description",line:!1,block:!1},code:{start:"`",end:"`",placeholder:"Add inline code here",line:!1,block:!1},pre:{start:"    ",end:"",placeholder:"Block Code",line:!0,block:!0},ul:{start:"* ",end:"",placeholder:"List Item",line:!0,block:!0},ol:{start:"1. ",end:"",placeholder:"List Item",line:!0,block:!0},break:{start:"",end:"\n{.clearfix}",placeholder:"",line:!0,block:!0},custom:{start:"",
end:"{.custom-class-here}",placeholder:"",line:!0,block:!1}};return this.each(function(){let a=this,h=!0,m=b(this).data("endpoint")||"/api/md_preview/",u=b('<div class="controls" id="'+a.id+'-controls" />'),v="fa-eye-slash",w=u;g&&(w=b(".full-preview"),v="fa-check");var r='<div class="btn-toolbar" role="toolbar" aria-label="Markdown Toolbar"><div class="btn-group mr-2 mb-1" role="group" aria-label="Formatting"><button type="button" data-toggle="tooltip" data-placement="bottom" title="Bold" class="btn btn-light c-bold"><i class="fas fa-bold"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Italic" class="btn btn-light c-italic"><i class="fas fa-italic"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Strikethrough" class="btn btn-light c-strike"><i class="fas fa-strikethrough"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Code" class="btn btn-light c-code"><i class="fas fa-code"></i></button>';
r=g?r+'<button type="button" data-toggle="tooltip" data-placement="bottom" title="Heading 2" class="btn btn-light c-h2news"><i class="fas fa-heading"></i>2</button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Heading 3" class="btn btn-light c-h3news"><i class="fas fa-heading"></i>3</button>':r+'<button type="button" data-toggle="tooltip" data-placement="bottom" title="Heading" class="btn btn-light c-h1"><i class="fas fa-heading"></i></button>';r+='<button type="button" data-toggle="tooltip" data-placement="bottom" title="Quote" class="btn btn-light c-quote"><i class="fas fa-quote-right"></i></button></div><div class="btn-group mr-2 mb-1" role="group" aria-label="Utilities"><button type="button" data-toggle="tooltip" data-placement="bottom" title="Link" class="btn btn-light c-link"><i class="fas fa-link"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Image" class="btn btn-light c-image"><i class="fas fa-image"></i></button>';
g&&(r+='<button type="button" data-toggle="tooltip" data-placement="bottom" title="Image (Left, 50% Width)" class="btn btn-light c-imageleft"><i class="fas fa-caret-left"></i>&nbsp;<i class="fas fa-image"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Image (Right, 50% Width)" class="btn btn-light c-imageright"><i class="fas fa-image"></i>&nbsp;<i class="fas fa-caret-right"></i></button>');r+='</div><div class="btn-group mr-2 mb-1" role="group" aria-label="Lists"><button type="button" data-toggle="tooltip" data-placement="bottom" title="Bullet List" class="btn btn-light c-ul"><i class="fas fa-list-ul"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Ordered List" class="btn btn-light c-ol"><i class="fas fa-list-ol"></i></button>';
g&&(r+='</div><div class="btn-group mr-2 mb-1" role="group" aria-label="Classes"><button type="button" data-toggle="tooltip" data-placement="bottom" title="Section Break" class="btn btn-light c-break"><i class="fas fa-level-down-alt"></i></button><button type="button" data-toggle="tooltip" data-placement="bottom" title="Custom Class" class="btn btn-light c-custom"><i class="fas fa-hammer"></i></button><button type="button" data-placement="bottom" title="Help" class="btn btn-light c-help" data-toggle="modal" data-target="#helpmodal"><i class="fas fa-question"></i></button>');
r+='</div><div class="btn-group mr-2 mb-1" role="group" aria-label="Preview"><button type="button" data-toggle="tooltip" data-placement="bottom" title="Preview" class="btn btn-light c-preview"><i class="fas fa-eye"></i></button></div></div>';g||(r+='<div class="preview"></div>');let z=function(){h?(h=!1,u.find(".fa-eye").removeClass("fa-eye").addClass(v),createPreview(a,w,m)):g||(w.find(".preview").slideUp(),u.find("."+v).removeClass(v).addClass("fa-eye"),h=!0);return!0},x;g&&(x=setTimeout(z,1));
b(a).before(u.append(r));g||u.find(".preview").slideUp();b(a).on("keydown",function(p){w.find(".card").addClass("text-muted");u.find("."+v).removeClass(v).addClass("fa-eye");h=!0;g&&(clearTimeout(x),x=setTimeout(z,600));return MarkdownHelper(a,p)});b("button",u).on("click",function(p){p.preventDefault();a.focus();var d=this.className.substr(16);p={start:a.selectionStart,end:a.selectionEnd};var e=n[d];if("preview"===d)return z();if("help"===d)return!0;var t=toLines(a.value,p);d=t.lines;let c=t.selection;
e===n.code&&c.start.line!==c.end.line&&(e=n.pre);let y=0;t=0;if(e.line)if(c.start.line===c.end.line&&""===d[c.start.line])d[c.start.line]=e.start+e.placeholder+e.end,t+=length(d[c.start.line]);else{y+=length(e.start);for(let A=c.start.line;A<=c.end.line;A++)d[A]=e.start+d[A]+e.end,t+=length(e.start)}else p.start!==p.end?(d[c.end.line]=d[c.end.line].substring(0,c.end.pos)+e.end+d[c.end.line].substring(c.end.pos),d[c.start.line]=d[c.start.line].substring(0,c.start.pos)+e.start+d[c.start.line].substring(c.start.pos),
y+=length(e.start),t+=length(e.start)):(d[c.start.line]=d[c.start.line].substring(0,c.start.pos)+e.start+e.placeholder+e.end+d[c.start.line].substring(c.start.pos),y+=length(e.start),t+=length(e.start+e.placeholder));e.block&&0<=c.start.line-1&&""!==d[c.start.line-1]&&(d[c.start.line]="\n"+d[c.start.line],y+=1,t+=1);e.block&&c.end.line+1<=d.length&&""!==d[c.end.line+1]&&(d[c.end.line]+="\n");a.value=d.join("\n");e=p.start+y;p=p.end+t;a.focus();a.setSelectionRange?a.setSelectionRange(k(a,e),k(a,p)):
a.createTextRange&&(d=a.createTextRange(),d.collapse(!0),d.moveEnd("character",p),d.moveStart("character",e),d.select());h=!0;w.find(".card").addClass("text-muted");u.find("."+v).removeClass(v).addClass("fa-eye");g&&(clearTimeout(x),x=setTimeout(z,600));return!0})})}})(jQuery,window,document);function createPreview(b,f,l){$.post(l,{md:b.value},function(q,g,k){f.find(".preview").html(q).slideDown()})}
function MarkdownHelper(b,f){let l,q,g,k;if(13===f.keyCode){var n=!1;f=b.value.replace(/\r\n/g,"\n");if(b.selectionStart)var a=b.selectionStart;else b.focus(),a=document.selection.createRange(),a.moveStart("character",-f.length),a=a.text.replace(/\r\n/g,"\n").length;l=f.split("\n");q=f.substr(0,a).split("\n").length;g=l[q-1].replace(/^\s+/,"");k=g.substr(0,2);if(RegExp("^[0-9]+[.] (.*)$").test(g)){var h=g.substr(0,g.indexOf(". "));var m=h+". ";h=parseInt(h,10)+1+". ";n=!0}g&&!n&&"    "===l[q-1].substr(0,
4)&&(m=h="    ",n=!0);0<=["* ","+ ","- "].indexOf(k)&&(m=h=k,n=!0);if(n)return n=l[q-1].indexOf(m),g.replace(/^\s+/,"")===m?(b.value=f.substr(0,a-1-n-h.length)+"\n\n"+f.substr(a,f.length),m=a+1-h.length-n):(b.value=f.substr(0,a)+"\n"+Array(n+1).join(" ")+h+f.substr(a,f.length),m=a+1+h.length+n),b.selectionStart?b.setSelectionRange(m,m):(a=b.createTextRange(),a.move("character",m),a.select()),!1}}function getCookie(b){return Cookies.get(b)};
